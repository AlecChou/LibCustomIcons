name: Generate Documentation
on:
  workflow_call:
jobs:
  docs:
    if: github.repository_owner == 'm00nyONE'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Generate docs with emmylua_doc_cli
        run: |
          URL=$(curl -s https://api.github.com/repos/EmmyLuaLs/emmylua-analyzer-rust/releases/latest | jq -r '.assets[] | select(.name? | match("emmylua_doc_cli-linux-x64.tar.gz$")) | .browser_download_url')
          if [ -n "$URL" ]; then
            curl -L "$URL" -o emmylua_doc_cli-linux-x64.tar.gz
          else
            echo "::error:: ‚ùå File not found in latest release."
            exit 1
          fi
          
          tar -xzf emmylua_doc_cli-linux-x64.tar.gz
          chmod +x emmylua_doc_cli-linux-x64.tar.gz

          ./emmylua_doc_cli --input . --output ./docs
      - name: Deploy docs
        uses: mhausenblas/mkdocs-deploy-gh-pages@master
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          CONFIG_FILE: docs/mkdocs.yml